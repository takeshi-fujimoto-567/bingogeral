<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Bingo – TV</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
:root{
  --bg:#F2F2F2;
  --panel:#FFFFFF;
  --cinza:#9A9A9A;
  --verde:#1F6B3B;
  --vermelho:#900;
}

*{box-sizing:border-box}

html,body{
  margin:0;
  height:100%;
  background:var(--bg);
  font-family:Arial,sans-serif;
}

.layout{
  display:grid;
  grid-template-columns:25% 75%;
  height:100%;
}

.destaque{
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:clamp(96px,10vw,180px);
  font-weight:900;
  color:var(--verde);
  border-right:4px solid #DDD;
}

.painel{
  padding:16px;
  display:flex;
  flex-direction:column;
  align-items:center;
}

h1{
  margin:0 0 12px;
  font-size:clamp(32px,4vw,56px);
  text-transform:uppercase;
}

.bingo{
  display:grid;
  grid-template-columns:repeat(5,1fr);
  gap:20px;
  width:100%;
  max-width:1200px;
}

.col{
  background:var(--panel);
  border-radius:16px;
  padding:12px;
  border:2px solid #DDD;
}

.col h2{
  text-align:center;
  margin:4px 0 10px;
}

.grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
}

.cell{
  text-align:center;
  padding:16px 0;
  border-radius:10px;
  border:2px solid #DDD;
  font-size:clamp(20px,2.4vw,34px);
  color:var(--cinza);
  cursor:pointer;
  user-select:none;
}

.cell.center{
  grid-column:span 2;
  width:85%;
  justify-self:center;
}

.cell.called{
  background:var(--verde);
  border-color:var(--verde);
  color:#FFF;
  font-weight:900;
}

.controls{
  margin-top:16px;
}

button{
  font-size:18px;
  padding:12px 32px;
  border:none;
  border-radius:12px;
  background:var(--vermelho);
  color:#FFF;
  font-weight:700;
}
</style>
</head>

<body>

<div class="layout">
  <div class="destaque" id="ultimo">—</div>

  <div class="painel">
    <h1 id="titulo">Carregando…</h1>
    <div class="bingo" id="bingo"></div>
    <div class="controls">
      <button onclick="resetar()">Resetar Bingo</button>
    </div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {

  const firebaseConfig = {
    apiKey: "AIzaSyBUhyCxXHxwcGIrA8hSrWoOUB55pt3fdFo",
    authDomain: "bingo-yakisoba-kai.firebaseapp.com",
    databaseURL: "https://bingo-yakisoba-kai-default-rtdb.firebaseio.com",
    projectId: "bingo-yakisoba-kai",
    storageBucket: "bingo-yakisoba-kai.firebasestorage.app",
    messagingSenderId: "202647902902",
    appId: "1:202647902902:web:d434bf96ae6de57de36417"
  };

  if (!firebase.apps.length) {
    firebase.initializeApp(firebaseConfig);
  }

  const ref = firebase.database().ref("bingo_atual");

  const titulo = document.getElementById("titulo");
  const ultimo = document.getElementById("ultimo");
  const bingo = document.getElementById("bingo");

  const grupos = [
    {l:"B",i:1},{l:"I",i:16},{l:"N",i:31},{l:"G",i:46},{l:"O",i:61}
  ];

  // CRIA GRADE
  grupos.forEach(g=>{
    const col=document.createElement("div");
    col.className="col";

    const h=document.createElement("h2");
    h.innerText=g.l;
    col.appendChild(h);

    const grid=document.createElement("div");
    grid.className="grid";

    for(let x=0;x<15;x++){
      const n=g.i+x;
      const cell=document.createElement("div");
      cell.className="cell";
      cell.innerText=n;
      cell.dataset.key=`${g.l}-${n}`;
      if(x===14) cell.classList.add("center");

      cell.onclick=()=>marcar(cell.dataset.key);

      grid.appendChild(cell);
    }

    col.appendChild(grid);
    bingo.appendChild(col);
  });

  function marcar(key){
    ref.transaction(data=>{
      if(!data) data={titulo:"Bingo da Oomoto",ultimo:"—",sorteados:{}};
      if(data.sorteados[key]) return;
      data.sorteados[key]=true;
      data.ultimo=key;
      return data;
    });
  }

  function resetar(){
    if(!confirm("Resetar o bingo?")) return;
    ref.set({titulo:"Bingo da Oomoto",ultimo:"—",sorteados:{}});
  }

  ref.on("value", snap=>{
    const d=snap.val();

    if(!d || !d.sorteados){
      titulo.innerText="Bingo da Oomoto";
      ultimo.innerText="—";
      document.querySelectorAll(".cell").forEach(c=>c.classList.remove("called"));
      return;
    }

    titulo.innerText=d.titulo;
    ultimo.innerText=d.ultimo;

    document.querySelectorAll(".cell").forEach(c=>{
      if(d.sorteados[c.dataset.key] === true){
        c.classList.add("called");
      }else{
        c.classList.remove("called");
      }
    });
  });

  window.resetar = resetar;
});
</script>

</body>
</html>
